# Railway Multi-Service Configuration
# Sentiment Trading Bot - Phase 1.3 Advanced Features

# ============================================================================
# SERVICE 1: WEB (Telegram Bot Webhook - FastAPI)
# ============================================================================
[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
# Railway injects PORT automatically - uvicorn reads it from environment
startCommand = "uvicorn backend.bot_webhook:app --host 0.0.0.0 --port ${PORT:-8080}"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Health check pour le bot webhook
[[deploy.healthcheck]]
path = "/health"
interval = 60
timeout = 10

# ============================================================================
# SERVICE 2: CELERY-WORKER (Async Task Processor)
# ============================================================================
# IMPORTANT: Railway ne crée PAS automatiquement les services depuis ce fichier.
# Tu dois les créer MANUELLEMENT dans l'interface Railway.
#
# Pour ajouter ce service:
# 1. Dans Railway Dashboard, clique "+ New Service"
# 2. Sélectionne "GitHub Repo" > sentiment-trading-bot
# 3. Nom du service: "celery-worker"
# 4. Settings > Start Command: celery -A backend.celery_app worker --loglevel=info --concurrency=2
# 5. Settings > Builder: Dockerfile
# 6. Variables d'env: Copier depuis service "web" (REDIS_URL, TELEGRAM_BOT_TOKEN, PERPLEXITY_API_KEY)
# 7. Connect au même Redis service

# ============================================================================
# SERVICE 3: CELERY-BEAT (Periodic Task Scheduler)
# ============================================================================
# Pour ajouter ce service:
# 1. Dans Railway Dashboard, clique "+ New Service"
# 2. Sélectionne "GitHub Repo" > sentiment-trading-bot
# 3. Nom du service: "celery-beat"
# 4. Settings > Start Command: celery -A backend.celery_app beat --loglevel=info
# 5. Settings > Builder: Dockerfile
# 6. Variables d'env: Copier depuis service "web"
# 7. Connect au même Redis service

# ============================================================================
# FEATURES CELERY (exécutées par worker + beat)
# ============================================================================
# - Feature 1: Price alerts (every 15min) - Notifications Telegram si BTC/ETH +10% ou -5%
# - Feature 4: AI recommendations (daily 8am) - Perplexity AI analyse et recommande BUY/SELL
# - Feature 5: Daily insights (daily 8am) - Résumé portfolio + news du jour

# ============================================================================
# VARIABLES D'ENVIRONNEMENT REQUISES (tous les services)
# ============================================================================
# REDIS_URL=<redis_internal_url>        # Railway Redis service (auto-injecté si connecté)
# TELEGRAM_BOT_TOKEN=<bot_token>        # Bot Telegram
# PERPLEXITY_API_KEY=<perplexity_key>   # API Perplexity AI
# WEBHOOK_URL=<railway_web_url>         # Seulement pour service "web"
# PORT=<auto>                            # Auto-injecté par Railway pour "web"
