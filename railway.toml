# Railway Multi-Service Configuration
# Sentiment Trading Bot - Phase 1.3 Advanced Features

# ============================================================================
# SERVICE 1: WEB (Telegram Bot Webhook - FastAPI)
# ============================================================================
[build]
builder = "DOCKERFILE"
dockerfilePath = "Dockerfile"

[deploy]
startCommand = "uvicorn backend.bot_webhook:app --host 0.0.0.0 --port $PORT"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Health check pour le bot webhook
[[deploy.healthcheck]]
path = "/health"
interval = 60
timeout = 10

# ============================================================================
# SERVICE 2: CELERY-WORKER (Async Task Processor)
# ============================================================================
# Pour ajouter ce service dans Railway:
# 1. Créer un nouveau service "celery-worker"
# 2. Connecter au même repo GitHub
# 3. Variables d'env: copier depuis service "web"
# 4. Start Command: celery -A backend.celery_app worker --loglevel=info --concurrency=2
# 5. Builder: Dockerfile

# ============================================================================
# SERVICE 3: CELERY-BEAT (Periodic Task Scheduler)
# ============================================================================
# Pour ajouter ce service dans Railway:
# 1. Créer un nouveau service "celery-beat"
# 2. Connecter au même repo GitHub
# 3. Variables d'env: copier depuis service "web"
# 4. Start Command: celery -A backend.celery_app beat --loglevel=info
# 5. Builder: Dockerfile

# ============================================================================
# NOTES DE DÉPLOIEMENT
# ============================================================================
# - Les 3 services partagent le même REDIS_URL (service Redis Railway)
# - Les 3 services partagent les mêmes variables d'environnement
# - web: Traite les commandes Telegram (port HTTP)
# - celery-worker: Exécute les tasks async (pas de port)
# - celery-beat: Planifie les tasks périodiques (pas de port)
#
# Features Celery:
# - Feature 1: Price alerts (every 15min)
# - Feature 4: AI recommendations (daily 8am)
# - Feature 5: Daily insights (daily 8am)

# ============================================================================
# VARIABLES D'ENVIRONNEMENT REQUISES (tous les services)
# ============================================================================
# REDIS_URL=<redis_internal_url>        # Railway Redis service
# TELEGRAM_BOT_TOKEN=<bot_token>
# PERPLEXITY_API_KEY=<perplexity_key>
# WEBHOOK_URL=<railway_web_url>         # Seulement pour "web"
# PORT=${{PORT}}                         # Auto-injecté par Railway pour "web"
